{
  "meta": {
    "project": "RAG-Enabled Chat Service",
    "date": "2025-10-17",
    "prepared_by": "Software Development Manager"
  },
  "product_overview": "This product is a RAG (Retrieval-Augmented Generation) enabled chat service that supports managing PDFs for knowledge ingestion, provides conversational AI chat capabilities with streaming responses, and includes comprehensive system health and bot management features.",
  "core_goals": [
    "Provide seamless PDF management for uploading, listing, and deletion to support knowledge augmentation.",
    "Enable chat interactions with streaming responses and support conversation history management including clearing and exporting.",
    "Maintain and monitor the RAG vector store and document ingestion status with cleaning capabilities.",
    "Offer robust health check endpoints for service monitoring.",
    "Toggle and monitor bot activity state to control chat availability."
  ],
  "key_features": [
    "Health API endpoint exposes service status, version, and environment information.",
    "PDF management with endpoints to upload, list, and delete PDF documents for RAG ingestion.",
    "RAG status and cleanup APIs to monitor and clear vector stores and ingested document data.",
    "Chat API supporting streaming chat responses, clear chat histories per conversation, export conversations to Excel, and provide usage statistics.",
    "Bot state APIs to get the current bot activity status and toggle it on or off."
  ],
  "user_flow_summary": [
    "User uploads a PDF via the PDFs API, which is ingested into the RAG system.",
    "User queries the chat API, receiving streaming responses from the conversational AI, backed by the RAG knowledge base.",
    "User clears conversation history by specifying the conversation ID via the chat API.",
    "User exports their conversations to an Excel file through the chat API export endpoint.",
    "User checks system health via the health API endpoint for service status.",
    "User retrieves the RAG ingestion and vector store status via the RAG API.",
    "User clears the RAG vector store and remaining PDFs via the RAG cleanup endpoint.",
    "User queries the current bot state and toggles it as needed through the bot API endpoints."
  ],
  "validation_criteria": [
    "All PDF uploads must be successfully stored and registered in the RAG ingestion system with appropriate error handling for file size limits.",
    "Chat streaming responses must be delivered seamlessly with correct handling of invalid inputs.",
    "Conversation histories must be cleared correctly given a valid conversation ID, and exported conversation files must be generated accurately.",
    "Health API must return the current system status, version, and environment without errors.",
    "RAG cleanup operations must correctly clear vector stores and update the status of remaining documents.",
    "Bot state toggling must accurately reflect in the state responses and maintain system consistency."
  ],
  "code_summary": {
    "tech_stack": [
      "Python 3.11",
      "FastAPI",
      "Uvicorn",
      "MongoDB",
      "Chroma Vector Store",
      "Node.js 20",
      "Next.js 14 (App Router)",
      "React 18",
      "TailwindCSS",
      "shadcn/ui",
      "Chakra UI",
      "TypeScript"
    ],
    "features": [
      {
        "name": "Health",
        "description": "Endpoint de estado del servicio backend.",
        "files": [
          "backend/api/app.py",
          "backend/api/routes/health/health_routes.py",
          "backend/api/schemas/health.py"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Health API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/v1/health/health": {
              "get": {
                "summary": "Health check",
                "responses": {
                  "200": {
                    "description": "Servicio OK",
                    "content": {
                      "application/json": {
                        "schema": {
                          "$ref": "#/components/schemas/HealthResponse"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "components": {
            "schemas": {
              "HealthResponse": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string"
                  },
                  "version": {
                    "type": "string"
                  },
                  "environment": {
                    "type": "string"
                  }
                },
                "required": [
                  "status",
                  "version",
                  "environment"
                ]
              }
            }
          }
        }
      },
      {
        "name": "PDFs",
        "description": "Gestión de PDFs para ingestión RAG (subir, listar, borrar).",
        "files": [
          "backend/api/routes/pdf/pdf_routes.py",
          "backend/storage/documents/pdf_manager.py",
          "backend/rag/ingestion/ingestor.py",
          "backend/api/schemas/pdf.py"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "PDFs API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/v1/pdfs/upload": {
              "post": {
                "summary": "Subir PDF",
                "requestBody": {
                  "required": true,
                  "content": {
                    "multipart/form-data": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "file": {
                            "type": "string",
                            "format": "binary"
                          }
                        },
                        "required": [
                          "file"
                        ]
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Subido",
                    "content": {
                      "application/json": {
                        "schema": {
                          "$ref": "#/components/schemas/PDFUploadResponse"
                        }
                      }
                    }
                  },
                  "413": {
                    "description": "Archivo muy grande"
                  }
                }
              }
            },
            "/api/v1/pdfs/list": {
              "get": {
                "summary": "Listar PDFs",
                "responses": {
                  "200": {
                    "description": "Lista PDFs",
                    "content": {
                      "application/json": {
                        "schema": {
                          "$ref": "#/components/schemas/PDFListResponse"
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/v1/pdfs/{filename}": {
              "delete": {
                "summary": "Eliminar PDF",
                "parameters": [
                  {
                    "in": "path",
                    "name": "filename",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Eliminado",
                    "content": {
                      "application/json": {
                        "schema": {
                          "$ref": "#/components/schemas/PDFDeleteResponse"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "components": {
            "schemas": {
              "PDFUploadResponse": {
                "type": "object",
                "properties": {
                  "message": {
                    "type": "string"
                  },
                  "file_path": {
                    "type": "string"
                  },
                  "pdfs_in_directory": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": [
                  "message",
                  "file_path",
                  "pdfs_in_directory"
                ]
              },
              "PDFListItem": {
                "type": "object",
                "properties": {
                  "filename": {
                    "type": "string"
                  },
                  "path": {
                    "type": "string"
                  },
                  "size": {
                    "type": "integer"
                  },
                  "last_modified": {
                    "type": "string",
                    "format": "date-time"
                  }
                },
                "required": [
                  "filename",
                  "path",
                  "size",
                  "last_modified"
                ]
              },
              "PDFListResponse": {
                "type": "object",
                "properties": {
                  "pdfs": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/PDFListItem"
                    }
                  }
                },
                "required": [
                  "pdfs"
                ]
              },
              "PDFDeleteResponse": {
                "type": "object",
                "properties": {
                  "message": {
                    "type": "string"
                  }
                },
                "required": [
                  "message"
                ]
              }
            }
          }
        }
      },
      {
        "name": "RAG",
        "description": "Estado y limpieza del índice/vector store del RAG.",
        "files": [
          "backend/api/routes/rag/rag_routes.py",
          "backend/rag/vector_store/vector_store.py",
          "backend/api/schemas/rag.py"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "RAG API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/v1/rag/rag-status": {
              "get": {
                "summary": "Estado RAG",
                "responses": {
                  "200": {
                    "description": "OK",
                    "content": {
                      "application/json": {
                        "schema": {
                          "$ref": "#/components/schemas/RAGStatusResponse"
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/v1/rag/clear-rag": {
              "post": {
                "summary": "Limpiar RAG",
                "responses": {
                  "200": {
                    "description": "Resultado limpieza",
                    "content": {
                      "application/json": {
                        "schema": {
                          "$ref": "#/components/schemas/ClearRAGResponse"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "components": {
            "schemas": {
              "RAGStatusPDFDetail": {
                "type": "object",
                "properties": {
                  "filename": {
                    "type": "string"
                  },
                  "path": {
                    "type": "string"
                  },
                  "size": {
                    "type": "integer"
                  },
                  "last_modified": {
                    "type": "string",
                    "format": "date-time"
                  }
                },
                "required": [
                  "filename",
                  "path",
                  "size",
                  "last_modified"
                ]
              },
              "RAGStatusVectorStoreDetail": {
                "type": "object",
                "properties": {
                  "path": {
                    "type": "string"
                  },
                  "exists": {
                    "type": "boolean"
                  },
                  "size": {
                    "type": "integer"
                  }
                },
                "required": [
                  "path",
                  "exists",
                  "size"
                ]
              },
              "RAGStatusResponse": {
                "type": "object",
                "properties": {
                  "pdfs": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/RAGStatusPDFDetail"
                    }
                  },
                  "vector_store": {
                    "$ref": "#/components/schemas/RAGStatusVectorStoreDetail"
                  },
                  "total_documents": {
                    "type": "integer"
                  }
                },
                "required": [
                  "pdfs",
                  "vector_store",
                  "total_documents"
                ]
              },
              "ClearRAGResponse": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string"
                  },
                  "message": {
                    "type": "string"
                  },
                  "remaining_pdfs": {
                    "type": "integer"
                  },
                  "vector_store_size": {
                    "type": "integer"
                  }
                },
                "required": [
                  "status",
                  "message",
                  "remaining_pdfs",
                  "vector_store_size"
                ]
              }
            }
          }
        }
      },
      {
        "name": "Chat",
        "description": "Chat con streaming, limpiar historial, exportar conversaciones y estadísticas.",
        "files": [
          "backend/api/routes/chat/chat_routes.py",
          "backend/api/schemas/chat.py",
          "backend/database/mongodb.py",
          "backend/chat/manager.py"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Chat API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/v1/chat/stream_log": {
              "post": {
                "summary": "Chat stream",
                "requestBody": {
                  "required": true,
                  "content": {
                    "application/json": {
                      "schema": {
                        "$ref": "#/components/schemas/ChatRequest"
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "SSE stream"
                  },
                  "422": {
                    "description": "Entrada inválida"
                  }
                }
              }
            },
            "/api/v1/chat/clear/{conversation_id}": {
              "post": {
                "summary": "Limpiar historial",
                "parameters": [
                  {
                    "in": "path",
                    "name": "conversation_id",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Limpieza ok",
                    "content": {
                      "application/json": {
                        "schema": {
                          "$ref": "#/components/schemas/ClearHistoryResponse"
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/v1/chat/export-conversations": {
              "get": {
                "summary": "Exportar conversaciones",
                "responses": {
                  "200": {
                    "description": "Archivo Excel"
                  },
                  "404": {
                    "description": "Sin datos"
                  }
                }
              }
            },
            "/api/v1/chat/stats": {
              "get": {
                "summary": "Estadísticas de uso",
                "responses": {
                  "200": {
                    "description": "Stats"
                  }
                }
              }
            }
          },
          "components": {
            "schemas": {
              "ChatRequest": {
                "type": "object",
                "properties": {
                  "input": {
                    "type": "string"
                  },
                  "conversation_id": {
                    "type": "string"
                  }
                },
                "required": [
                  "input"
                ]
              },
              "StreamEventData": {
                "type": "object",
                "properties": {
                  "streamed_output": {
                    "type": "string"
                  },
                  "ops": {
                    "nullable": true
                  }
                },
                "required": [
                  "streamed_output"
                ]
              },
              "ClearHistoryResponse": {
                "type": "object",
                "properties": {
                  "message": {
                    "type": "string"
                  }
                },
                "required": [
                  "message"
                ]
              }
            }
          }
        }
      },
      {
        "name": "Bot",
        "description": "Gestión de estado del bot (activo/inactivo).",
        "files": [
          "backend/api/routes/bot/bot_routes.py",
          "backend/core/bot.py"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Bot API",
            "version": "1.0.0"
          },
          "paths": {
            "/api/v1/bot/state": {
              "get": {
                "summary": "Obtener estado del bot",
                "responses": {
                  "200": {
                    "description": "Estado",
                    "content": {
                      "application/json": {
                        "schema": {
                          "$ref": "#/components/schemas/BotStateResponse"
                        }
                      }
                    }
                  }
                }
              }
            },
            "/api/v1/bot/toggle": {
              "post": {
                "summary": "Alternar estado del bot",
                "responses": {
                  "200": {
                    "description": "Nuevo estado",
                    "content": {
                      "application/json": {
                        "schema": {
                          "$ref": "#/components/schemas/BotStateResponse"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "components": {
            "schemas": {
              "BotStateResponse": {
                "type": "object",
                "properties": {
                  "is_active": {
                    "type": "boolean"
                  },
                  "message": {
                    "type": "string"
                  }
                },
                "required": [
                  "is_active",
                  "message"
                ]
              }
            }
          }
        }
      }
    ]
  }
}

{
    "openapi":  "3.1.0",
    "info":  {
                 "title":  "ChatBot RAG API",
                 "description":  "API para el ChatBot con RAG",
                 "version":  "1.0.0"
             },
    "paths":  {
                  "/api/v1/health":  {
                                         "get":  {
                                                     "tags":  "health",
                                                     "summary":  "Health Check",
                                                     "description":  "Health check endpoint for the API.",
                                                     "operationId":  "health_check_api_v1_health_get",
                                                     "responses":  "@{200=}"
                                                 }
                                     },
                  "/api/v1/auth/login":  {
                                             "post":  {
                                                          "tags":  "auth Authentication",
                                                          "summary":  "User login",
                                                          "description":  "Authenticate user and return JWT tokens",
                                                          "operationId":  "login_api_v1_auth_login_post",
                                                          "requestBody":  "@{content=; required=True}",
                                                          "responses":  "@{200=; 400=; 401=; 422=; 500=}"
                                                      }
                                         },
                  "/api/v1/auth/me":  {
                                          "get":  {
                                                      "tags":  "auth Authentication",
                                                      "summary":  "Get current user profile",
                                                      "description":  "Get the profile of the currently authenticated user",
                                                      "operationId":  "get_current_user_profile_api_v1_auth_me_get",
                                                      "responses":  "@{200=; 401=; 500=}",
                                                      "security":  ""
                                                  }
                                      },
                  "/api/v1/auth/refresh":  {
                                               "post":  {
                                                            "tags":  "auth Authentication",
                                                            "summary":  "Refresh access token",
                                                            "description":  "Use refresh token to get new access token",
                                                            "operationId":  "refresh_access_token_api_v1_auth_refresh_post",
                                                            "requestBody":  "@{content=; required=True}",
                                                            "responses":  "@{200=; 401=; 422=; 500=}"
                                                        }
                                           },
                  "/api/v1/auth/logout":  {
                                              "post":  {
                                                           "tags":  "auth Authentication",
                                                           "summary":  "User logout",
                                                           "description":  "Logout current user (client-side token removal)",
                                                           "operationId":  "logout_api_v1_auth_logout_post",
                                                           "responses":  "@{200=; 401=}",
                                                           "security":  ""
                                                       }
                                          },
                  "/api/v1/pdfs/upload":  {
                                              "post":  {
                                                           "tags":  "pdfs pdfs",
                                                           "summary":  "Upload Pdf",
                                                           "description":  "Endpoint para subir y procesar PDFs de forma asíncrona.",
                                                           "operationId":  "upload_pdf_api_v1_pdfs_upload_post",
                                                           "requestBody":  "@{content=; required=True}",
                                                           "responses":  "@{200=; 422=}"
                                                       }
                                          },
                  "/api/v1/pdfs/list":  {
                                            "get":  {
                                                        "tags":  "pdfs pdfs",
                                                        "summary":  "List Pdfs",
                                                        "description":  "Endpoint para listar los PDFs disponibles.",
                                                        "operationId":  "list_pdfs_api_v1_pdfs_list_get",
                                                        "responses":  "@{200=}"
                                                    }
                                        },
                  "/api/v1/pdfs/{filename}":  {
                                                  "delete":  {
                                                                 "tags":  "pdfs pdfs",
                                                                 "summary":  "Delete Pdf",
                                                                 "description":  "Endpoint para eliminar un PDF específico.",
                                                                 "operationId":  "delete_pdf_api_v1_pdfs__filename__delete",
                                                                 "parameters":  "",
                                                                 "responses":  "@{200=; 422=}"
                                                             }
                                              },
                  "/api/v1/pdfs/download/{filename}":  {
                                                           "get":  {
                                                                       "tags":  "pdfs pdfs",
                                                                       "summary":  "Download Pdf",
                                                                       "description":  "Sirve un PDF directamente para visualización/descarga en el navegador.",
                                                                       "operationId":  "download_pdf_api_v1_pdfs_download__filename__get",
                                                                       "parameters":  "",
                                                                       "responses":  "@{200=; 422=}"
                                                                   }
                                                       },
                  "/api/v1/pdfs/view/{filename}":  {
                                                       "get":  {
                                                                   "tags":  "pdfs pdfs",
                                                                   "summary":  "View Pdf",
                                                                   "description":  "Sirve un PDF para visualización inline en el navegador (sin attachment).",
                                                                   "operationId":  "view_pdf_api_v1_pdfs_view__filename__get",
                                                                   "parameters":  "",
                                                                   "responses":  "@{200=; 422=}"
                                                               }
                                                   },
                  "/api/v1/rag/rag-status":  {
                                                 "get":  {
                                                             "tags":  "rag",
                                                             "summary":  "Rag Status",
                                                             "description":  "Endpoint para obtener el estado actual del RAG.",
                                                             "operationId":  "rag_status_api_v1_rag_rag_status_get",
                                                             "responses":  "@{200=}"
                                                         }
                                             },
                  "/api/v1/rag/clear-rag":  {
                                                "post":  {
                                                             "tags":  "rag",
                                                             "summary":  "Clear Rag",
                                                             "description":  "Endpoint para limpiar el RAG.",
                                                             "operationId":  "clear_rag_api_v1_rag_clear_rag_post",
                                                             "responses":  "@{200=}"
                                                         }
                                            },
                  "/api/v1/rag/retrieve-debug":  {
                                                     "post":  {
                                                                  "tags":  "rag",
                                                                  "summary":  "Retrieve Debug",
                                                                  "description":  "Endpoint para auditar la recuperación RAG con detalles por chunk.\n\nProtegido por autenticación (solo admin). No altera el estado del sistema.",
                                                                  "operationId":  "retrieve_debug_api_v1_rag_retrieve_debug_post",
                                                                  "requestBody":  "@{content=; required=True}",
                                                                  "responses":  "@{200=; 422=}"
                                                              }
                                                 },
                  "/api/v1/chat/":  {
                                        "post":  {
                                                     "tags":  "chat",
                                                     "summary":  "Chat Stream Log",
                                                     "description":  "Endpoint para chat con streaming y logging.",
                                                     "operationId":  "chat_stream_log_api_v1_chat__post",
                                                     "responses":  "@{200=}"
                                                 }
                                    },
                  "/api/v1/chat/export-conversations":  {
                                                            "get":  {
                                                                        "tags":  "chat",
                                                                        "summary":  "Export Conversations",
                                                                        "description":  "Exporta todas las conversaciones a un archivo Excel.",
                                                                        "operationId":  "export_conversations_api_v1_chat_export_conversations_get",
                                                                        "responses":  "@{200=}"
                                                                    }
                                                        },
                  "/api/v1/chat/stats":  {
                                             "get":  {
                                                         "tags":  "chat",
                                                         "summary":  "Get Stats",
                                                         "description":  "Obtiene estadísticas de consultas, usuarios activos y PDFs cargados.",
                                                         "operationId":  "get_stats_api_v1_chat_stats_get",
                                                         "responses":  "@{200=}"
                                                     }
                                         },
                  "/api/v1/bot/state":  {
                                            "get":  {
                                                        "tags":  "bot bot",
                                                        "summary":  "Get Bot State",
                                                        "description":  "Obtener el estado actual del bot.",
                                                        "operationId":  "get_bot_state_api_v1_bot_state_get",
                                                        "responses":  "@{200=}"
                                                    }
                                        },
                  "/api/v1/bot/toggle":  {
                                             "post":  {
                                                          "tags":  "bot bot",
                                                          "summary":  "Toggle Bot State",
                                                          "description":  "Activar o desactivar el bot.",
                                                          "operationId":  "toggle_bot_state_api_v1_bot_toggle_post",
                                                          "responses":  "@{200=}"
                                                      }
                                         },
                  "/api/v1/bot/runtime":  {
                                              "get":  {
                                                          "tags":  "bot bot",
                                                          "summary":  "Get Bot Runtime",
                                                          "description":  "Inspeccionar configuración runtime actual del bot (modelo, temperatura, prompt efectivo).",
                                                          "operationId":  "get_bot_runtime_api_v1_bot_runtime_get",
                                                          "responses":  "@{200=}"
                                                      }
                                          },
                  "/api/v1/bot/config":  {
                                             "get":  {
                                                         "tags":  "bot bot",
                                                         "summary":  "Get Bot Config",
                                                         "description":  "Return current bot configuration.",
                                                         "operationId":  "get_bot_config_api_v1_bot_config_get",
                                                         "responses":  "@{200=}"
                                                     },
                                             "put":  {
                                                         "tags":  "bot bot",
                                                         "summary":  "Update Bot Config",
                                                         "description":  "Update bot configuration fields (admin only).",
                                                         "operationId":  "update_bot_config_api_v1_bot_config_put",
                                                         "requestBody":  "@{content=; required=True}",
                                                         "responses":  "@{200=; 422=}"
                                                     }
                                         },
                  "/api/v1/bot/config/reset":  {
                                                   "post":  {
                                                                "tags":  "bot bot",
                                                                "summary":  "Reset Bot Config",
                                                                "description":  "Clear UI-driven fields and reload runtime (admin only).",
                                                                "operationId":  "reset_bot_config_api_v1_bot_config_reset_post",
                                                                "responses":  "@{200=}"
                                                            }
                                               },
                  "/api/v1/users":  {
                                        "get":  {
                                                    "tags":  "users users",
                                                    "summary":  "List Users",
                                                    "operationId":  "list_users_api_v1_users_get",
                                                    "security":  "",
                                                    "parameters":  "    ",
                                                    "responses":  "@{200=; 422=}"
                                                },
                                        "post":  {
                                                     "tags":  "users users",
                                                     "summary":  "Create User",
                                                     "operationId":  "create_user_api_v1_users_post",
                                                     "security":  "",
                                                     "requestBody":  "@{required=True; content=}",
                                                     "responses":  "@{201=; 422=}"
                                                 }
                                    },
                  "/api/v1/users/{user_id}":  {
                                                  "delete":  {
                                                                 "tags":  "users users",
                                                                 "summary":  "Delete User",
                                                                 "operationId":  "delete_user_api_v1_users__user_id__delete",
                                                                 "security":  "",
                                                                 "parameters":  "",
                                                                 "responses":  "@{204=; 422=}"
                                                             },
                                                  "patch":  {
                                                                "tags":  "users users",
                                                                "summary":  "Update User",
                                                                "operationId":  "update_user_api_v1_users__user_id__patch",
                                                                "security":  "",
                                                                "parameters":  "",
                                                                "requestBody":  "@{required=True; content=}",
                                                                "responses":  "@{200=; 422=}"
                                                            }
                                              }
              },
    "components":  {
                       "schemas":  {
                                       "AuthErrorResponse":  {
                                                                 "properties":  "@{detail=; error_code=}",
                                                                 "type":  "object",
                                                                 "required":  "detail",
                                                                 "title":  "AuthErrorResponse",
                                                                 "description":  "Authentication error response model.",
                                                                 "example":  "@{detail=Invalid credentials; error_code=INVALID_CREDENTIALS}"
                                                             },
                                       "Body_upload_pdf_api_v1_pdfs_upload_post":  {
                                                                                       "properties":  "@{file=}",
                                                                                       "type":  "object",
                                                                                       "required":  "file",
                                                                                       "title":  "Body_upload_pdf_api_v1_pdfs_upload_post"
                                                                                   },
                                       "BotConfigDTO":  {
                                                            "properties":  "@{system_prompt=; temperature=; updated_at=; bot_name=; ui_prompt_extra=}",
                                                            "type":  "object",
                                                            "required":  "updated_at",
                                                            "title":  "BotConfigDTO",
                                                            "description":  "Bot configuration data transfer object."
                                                        },
                                       "BotRuntimeResponse":  {
                                                                  "properties":  "@{model_name=; temperature=; max_tokens=; bot_name=; ui_prompt_extra_len=; effective_personality_len=}",
                                                                  "type":  "object",
                                                                  "title":  "BotRuntimeResponse",
                                                                  "description":  "Modelo de respuesta para inspeccionar configuración runtime del bot."
                                                              },
                                       "BotStateResponse":  {
                                                                "properties":  "@{is_active=; message=}",
                                                                "type":  "object",
                                                                "required":  "is_active message",
                                                                "title":  "BotStateResponse",
                                                                "description":  "Modelo de respuesta para el estado del bot."
                                                            },
                                       "ClearRAGResponse":  {
                                                                "properties":  "@{status=; message=; remaining_pdfs=; vector_store_size=}",
                                                                "type":  "object",
                                                                "required":  "message remaining_pdfs vector_store_size",
                                                                "title":  "ClearRAGResponse",
                                                                "description":  "Response model for clear RAG endpoint."
                                                            },
                                       "CreateUserRequest":  {
                                                                 "properties":  "@{username=; email=; password=; full_name=; is_admin=}",
                                                                 "type":  "object",
                                                                 "required":  "email password",
                                                                 "title":  "CreateUserRequest"
                                                             },
                                       "HTTPValidationError":  {
                                                                   "properties":  "@{detail=}",
                                                                   "type":  "object",
                                                                   "title":  "HTTPValidationError"
                                                               },
                                       "HealthResponse":  {
                                                              "properties":  "@{status=; version=; environment=}",
                                                              "type":  "object",
                                                              "required":  "version environment",
                                                              "title":  "HealthResponse",
                                                              "description":  "Response model for health check endpoint."
                                                          },
                                       "LoginRequest":  {
                                                            "properties":  "@{email=; password=}",
                                                            "type":  "object",
                                                            "required":  "email password",
                                                            "title":  "LoginRequest",
                                                            "description":  "Login request model.",
                                                            "example":  "@{email=admin@example.com; password=securepassword123}"
                                                        },
                                       "PDFDeleteResponse":  {
                                                                 "properties":  "@{status=; message=}",
                                                                 "type":  "object",
                                                                 "required":  "message",
                                                                 "title":  "PDFDeleteResponse",
                                                                 "description":  "Response model for PDF delete endpoint."
                                                             },
                                       "PDFListItem":  {
                                                           "properties":  "@{filename=; path=; size=; last_modified=}",
                                                           "type":  "object",
                                                           "required":  "filename path size last_modified",
                                                           "title":  "PDFListItem",
                                                           "description":  "Model for PDF file information."
                                                       },
                                       "PDFListResponse":  {
                                                               "properties":  "@{pdfs=}",
                                                               "type":  "object",
                                                               "required":  "pdfs",
                                                               "title":  "PDFListResponse",
                                                               "description":  "Response model for PDF list endpoint."
                                                           },
                                       "PDFUploadResponse":  {
                                                                 "properties":  "@{status=; message=; file_path=; pdfs_in_directory=}",
                                                                 "type":  "object",
                                                                 "required":  "message file_path pdfs_in_directory",
                                                                 "title":  "PDFUploadResponse",
                                                                 "description":  "Response model for PDF upload endpoint."
                                                             },
                                       "PaginatedUsersResponse":  {
                                                                      "properties":  "@{items=; total=; skip=; limit=}",
                                                                      "type":  "object",
                                                                      "required":  "items total skip limit",
                                                                      "title":  "PaginatedUsersResponse"
                                                                  },
                                       "RAGStatusPDFDetail":  {
                                                                  "properties":  "@{filename=; path=; size=; last_modified=}",
                                                                  "type":  "object",
                                                                  "required":  "filename path size last_modified",
                                                                  "title":  "RAGStatusPDFDetail",
                                                                  "description":  "Model for PDF details in RAG status."
                                                              },
                                       "RAGStatusResponse":  {
                                                                 "properties":  "@{pdfs=; vector_store=; total_documents=}",
                                                                 "type":  "object",
                                                                 "required":  "pdfs vector_store total_documents",
                                                                 "title":  "RAGStatusResponse",
                                                                 "description":  "Response model for RAG status endpoint."
                                                             },
                                       "RAGStatusVectorStoreDetail":  {
                                                                          "properties":  "@{path=; exists=; size=}",
                                                                          "type":  "object",
                                                                          "required":  "path exists size",
                                                                          "title":  "RAGStatusVectorStoreDetail",
                                                                          "description":  "Model for vector store details in RAG status."
                                                                      },
                                       "RefreshTokenRequest":  {
                                                                   "properties":  "@{refresh_token=}",
                                                                   "type":  "object",
                                                                   "required":  "refresh_token",
                                                                   "title":  "RefreshTokenRequest",
                                                                   "description":  "Refresh token request model.",
                                                                   "example":  "@{refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...}"
                                                               },
                                       "RetrieveDebugItem":  {
                                                                 "properties":  "@{score=; source=; file_path=; content_hash=; chunk_type=; word_count=; preview=}",
                                                                 "type":  "object",
                                                                 "required":  "score preview",
                                                                 "title":  "RetrieveDebugItem",
                                                                 "description":  "Item describing one retrieved chunk for audit."
                                                             },
                                       "RetrieveDebugRequest":  {
                                                                    "properties":  "@{query=; k=; filter_criteria=; include_context=}",
                                                                    "type":  "object",
                                                                    "required":  "query",
                                                                    "title":  "RetrieveDebugRequest",
                                                                    "description":  "Request model for retrieve-debug endpoint."
                                                                },
                                       "RetrieveDebugResponse":  {
                                                                     "properties":  "@{query=; k=; retrieved=; context=; timings=}",
                                                                     "type":  "object",
                                                                     "required":  "query k retrieved timings",
                                                                     "title":  "RetrieveDebugResponse",
                                                                     "description":  "Response model for retrieve-debug endpoint."
                                                                 },
                                       "TokenResponse":  {
                                                             "properties":  "@{access_token=; refresh_token=; token_type=; expires_in=}",
                                                             "type":  "object",
                                                             "required":  "access_token refresh_token expires_in",
                                                             "title":  "TokenResponse",
                                                             "description":  "Token response model.",
                                                             "example":  "@{access_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; expires_in=1800; refresh_token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...; token_type=bearer}"
                                                         },
                                       "UpdateBotConfigRequest":  {
                                                                      "properties":  "@{system_prompt=; temperature=; bot_name=; ui_prompt_extra=}",
                                                                      "type":  "object",
                                                                      "title":  "UpdateBotConfigRequest",
                                                                      "description":  "Request payload to update bot configuration."
                                                                  },
                                       "UpdateUserRequest":  {
                                                                 "properties":  "@{email=; full_name=; is_admin=; is_active=; password=}",
                                                                 "type":  "object",
                                                                 "title":  "UpdateUserRequest"
                                                             },
                                       "UserProfileResponse":  {
                                                                   "properties":  "@{id=; email=; full_name=; is_active=; is_admin=; created_at=; updated_at=; last_login=}",
                                                                   "type":  "object",
                                                                   "required":  "id email is_active is_admin created_at updated_at",
                                                                   "title":  "UserProfileResponse",
                                                                   "description":  "User profile response model.",
                                                                   "example":  "@{created_at=2024-01-01T00:00:00Z; email=admin@example.com; full_name=Admin User; id=507f1f77bcf86cd799439011; is_active=True; is_admin=True; last_login=2024-01-01T12:00:00Z; updated_at=2024-01-01T00:00:00Z}"
                                                               },
                                       "UserResponse":  {
                                                            "properties":  "@{id=; username=; email=; full_name=; is_active=; is_admin=; created_at=; updated_at=; last_login=}",
                                                            "type":  "object",
                                                            "required":  "id username email is_active is_admin created_at updated_at",
                                                            "title":  "UserResponse"
                                                        },
                                       "ValidationError":  {
                                                               "properties":  "@{loc=; msg=; type=}",
                                                               "type":  "object",
                                                               "required":  "loc msg type",
                                                               "title":  "ValidationError"
                                                           }
                                   },
                       "securitySchemes":  {
                                               "HTTPBearer":  {
                                                                  "type":  "http",
                                                                  "scheme":  "bearer"
                                                              }
                                           }
                   }
}

